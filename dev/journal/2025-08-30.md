# Journal for today (Stage 0, full chronology)
cat > dev/journal/2025-08-30.md <<'EOF'
# Basalang Build Journal — Stage 0 (Developer Environment)
Date: 2025-08-30 (UTC)  
Host: basalang-dev-01 (Hetzner, Helsinki) — IPv4 157.180.124.227  
Local Dev: Windows 10/11 + VS Code (Remote-SSH, Dev Containers)

## Objective
Provision a cloud-first, containerized development environment with CI guardrails, journaling, and phase tagging.

---

## S0-T01 — Provision Remote Host
**What/Why:** Create a remote Linux box for all dev work (no local builds).  
**Provider/Plan:** Hetzner Cloud, CPX11 (2 vCPU, 4GB RAM, 40GB SSD).  
**OS:** Ubuntu 24.04 LTS.  
**Steps:**
- Created project `Basalang-Cloud` in Hetzner Console.
- Generated local SSH key (Windows MINGW64):
  - `ssh-keygen -t rsa -b 4096 -C "enrico.acha@gmail.com"`
  - Keys at `C:\Users\suberu\Desktop\basalang\.ssh\id_rsa[.pub]`.
- Added public key in Hetzner → SSH Keys.
- Created server `basalang-dev-01` (Helsinki).  
**Result:** Server online with public IP, reachable via SSH.

---

## S0-T02 — Secure Host + SSH Validation
**Why:** Enforce key-only auth, non-root user, firewall.  
**Steps (as root on host):**
- `hostnamectl set-hostname basalang-dev-01`
- `adduser ubuntu && usermod -aG sudo ubuntu`
- Authorized keys for `ubuntu`:
  - `mkdir -p /home/ubuntu/.ssh`
  - `cp ~/.ssh/authorized_keys /home/ubuntu/.ssh/`
  - `chown -R ubuntu:ubuntu /home/ubuntu/.ssh`
  - `chmod 700 /home/ubuntu/.ssh && chmod 600 /home/ubuntu/.ssh/authorized_keys`
- SSH hardening (`/etc/ssh/sshd_config`):
  - `PermitRootLogin no`
  - `PasswordAuthentication no`
  - `systemctl restart ssh`
- UFW:
  - `ufw allow OpenSSH && ufw enable`
**Validation:** Local → `ssh -i ... ubuntu@157.180.124.227` (success).

---

## S0-T03 — Devcontainer Bootstrap (Host Tooling)
**Why:** Dockerized dev environment + compose.  
**Host Commands (as ubuntu):**
- `sudo apt update && sudo apt upgrade -y`
- Essentials: `sudo apt install -y ca-certificates curl gnupg lsb-release git sudo unzip`
- Docker: `curl -fsSL https://get.docker.com | sudo bash`
- Group: `sudo usermod -aG docker $USER && newgrp docker`
- Test: `docker run hello-world` (success).
- Docker Compose: downloaded to `/usr/local/bin/docker-compose` (v2.27.0).  
**Validation:** `docker --version`, `docker-compose --version`, `git --version`.

---

## S0-T04 — Monorepo Setup
**Why:** Canonical structure for all phases.  
**Dirs Created:**
basalang/
├─ .devcontainer/
├─ backend/
├─ frontend/
├─ infra/
├─ dev/
├─ docs/
└─ README.md

**Init:** `git init` (default branch, later branched to phase/0).

---

## S0-T05 — Devcontainer Configuration
**Files added (`.devcontainer/`):**
- `devcontainer.json`
- `Dockerfile`
- `.env`

**devcontainer.json (key parts):**
- `"dockerFile": "Dockerfile"`
- `"remoteUser": "ubuntu"`
- Extensions: Docker, ESLint, Prettier, GH PRs.
- Ports: `[3000, 3001]`
- Named volume: `basalang-vol:/workspace`

**Dockerfile (key parts):**
- `FROM node:20-bullseye`
- Installs: `git curl unzip sudo vim`
- Creates user `ubuntu` (passwordless sudo)
- `WORKDIR /workspace`

---

## S0-T06 — Remote VS Code + First Container Build
**Why:** Dev happens inside the container over SSH.  
**Steps:**
- VS Code → Remote-SSH host `ubuntu@157.180.124.227`.
- Open folder `/home/ubuntu/basalang`.
- Prompt → “Reopen in Container” → build OK.
- Fixed container permissions for editing:
  - `sudo chown -R ubuntu:ubuntu /workspaces/basalang`
- Installed helpful tools **inside** container:
  - `sudo apt install -y nano tree bsdmainutils`
- Verified tooling: `node -v`, `git --version` (2.30.2 inside container).

**Note:** Docker CLI is on the host (expected). Devcontainer does not need Docker in Docker.

---

## S0-T07 — CI + Drift Guards (GitHub Actions)
**Added:** `.github/workflows/ci.yml`  
**Checks:**
- Repo structure guard (backend/frontend/infra/dev/docs present).
- Devcontainer Dockerfile presence check.
**Trigger:** on push and PR to any branch.

---

## S0-T08 — Autologging + Dev Directives Sync
**Why:** Enforce recorded history of “what/why/how” for every change.  
**Created:**
dev/_directives.md # index of governing protocols
dev/_reflection.md # running AI-human sync notes
dev/journal/2025-08-30.md # (this file)

**Seeded rules:** Journal per session; reflection after each feature phase.

---

## S0-T09 — Phase Tagging + Safe Commit Protocol
**Branching:** `feature/{slug}`, `fix/{slug}`, `phase/{n}`.  
**Commit style:** `[Phase X] {Action}: {Description}`  
**Tags:** `phase-X-complete`, releases `vX.Y.Z`.

**Applied:**
- `git checkout -b phase/0`
- Commit baseline: `"[Phase 0] Add: Baseline repo structure and devcontainer"`
- Remote: `git@github.com:enepac/basalang.git`
- **SSH to GitHub troubleshooting & resolution:**
  - Ensured `~/.ssh/authorized_keys` contained correct **public** key.
  - Added **private** key to `~/.ssh/id_rsa` (correct OpenSSH format), `chmod 600`.
  - `~/.ssh/config` → force `IdentityFile ~/.ssh/id_rsa` + `IdentitiesOnly yes`.
  - Verified with `ssh -T git@github.com` → success.
- Pushed:
  - `git push -u origin phase/0`
  - `git tag phase-0-complete && git push origin phase-0-complete`

---

## Artifacts (End of Stage 0)
- **Host**: Ubuntu 24.04, Docker OK, firewall on, SSH hardened.
- **Repo**: `enepac/basalang` — branch `phase/0`, tag `phase-0-complete`.
- **Devcontainer**: Node 20; base tools available; ready for Next.js.
- **CI**: minimal structure + Dockerfile checks wired.
- **Journaling**: `dev/journal/2025-08-30.md` (this), `_reflection.md` seeded.

## Next Entry Point
Stage 1 — App Boot, Auth, UI Shell:
- Initialize Next.js app in `frontend/` with Tailwind + base layout.
- Add auth scaffolding.
EOF

---

## S1-T01 — Scaffold Web App
**Why:** Begin frontend system: Next.js 14, App Router, TS, Tailwind, ESLint  
**Branch:** `phase/1`  
**Steps:**
- Ran `create-next-app@14.1.0` into `/workspaces/basalang/frontend` with flags:
  - `--app --ts --eslint --tailwind --no-src-dir --import-alias "@/*"`
- Install ran via `npm`, warnings OK, success confirmed
- Output structure:
  - `/app/page.tsx`, `/tailwind.config.ts`, `/tsconfig.json` with `@/*` alias

**Result:** Frontend scaffolded and ready for layout shell in S1-T02


---

## S1-T02 — UI Shell & Routes
**Why:** Provide main layout and navigable routes (Session, Practice, Docs)  
**Branch:** `phase/1`  
**Steps:**
- Replaced `app/layout.tsx` with sidebar shell (App name, nav, footer)
- Created new pages:
  - `/session/page.tsx` → "Live Session"
  - `/practice/page.tsx` → "Practice Mode"
  - `/docs/page.tsx` → "Documentation"
- Tailwind classes applied for visual hierarchy and status placeholders

**Result:** App layout functional; routes render properly with shared shell

